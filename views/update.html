<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuyStore - admin</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/logo/logostoreblue.png">

    <!-- link css -->
    <link rel="stylesheet" href="../assets/css/base.css">
    <link rel="stylesheet" href="../assets/css/admin.css">

    <!-- link icon -->
    <link rel="stylesheet" href="../assets/font/themify-icons-font/themify-icons/themify-icons.css">
    <link rel="stylesheet" href="../assets/font/fontawesome-free-6.4.2/fontawesome-free-6.4.2/css/all.css">
</head>
<body>
    <div class="admin">
        <div class="admin-header">
            <div class="grid">
                <div class="admin-nav">
                    <img src="../assets/img/logo/logo.png" alt="" class="admin-nav__img">

                    <ul class="admin-nav__list">
                        <li class="admin-nav__item">
                            <a href="admin.html" class="admin-nav__link">
                                Quản lí sản phẩm
                                <i class="admin-nav__icon fa-solid fa-caret-down"></i>
                            </a>
                        </li>
                        
                        <li class="admin-nav__item">
                            <a href="" class="admin-nav__link">
                                Quản lí hóa đơn
                                <i class="admin-nav__icon fa-solid fa-caret-down"></i>
                            </a>
                        </li>
                        
                        <li class="admin-nav__item">
                            <a href="" class="admin-nav__link">
                                Quản lí Tài khoản
                                <i class="admin-nav__icon fa-solid fa-caret-down"></i>
                            </a>
                        </li>
                    </ul>

                    <div class="admin-nav__logout">
                        <a href="login.html" class="admin-nav__logout-link">
                            <i class="admin-nav__logout-icon fa-solid fa-right-to-bracket"></i>
                        </a>
                    </div>

                </div>
            </div>
        </div>

        <div class="admin-container">
            <div class="grid">
                <div class="grid__row">
                    <div class="grid__column-3">
                        <div class="admin-container-info">
                            <div class="admin-container-blog">
                                <div class="admin-container-wallp" style="background-image: linear-gradient(180deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.7)), url(../assets/img/info/wallp3.jpg);">
                                    <img src="../assets/img/info/avt.png" alt="" class="admin-container-avt">
                                    <div class="admin-container-forme">
                                        <span class="admin-container-name">Phạm Anh Duy</span>
                                        <span class="admin-container-date">Ngày sinh: 27th November 2003</span>
                                    </div>
                                </div>
                            </div>

                            <div class="admin-container-contact">
                                <ul class="admin-container-contact-list">
                                    <h3 class="admin-container-contact-heading">Quản lí tài khoản</h3>
                                    <li class="admin-container-contact-bio">
                                        <a href="" class="admin-container-contact-link">
                                            <i class="admin-container-contact-icon fa-solid fa-user"></i>
                                            Tài khoản cá nhân
                                        </a>
                                    </li>
                                    
                                    <li class="admin-container-contact-bio">
                                        <a href="" class="admin-container-contact-link">
                                            <i class="admin-container-contact-icon fa-solid fa-location-dot"></i>
                                            Địa chỉ
                                        </a>
                                    </li>
                                    
                                    <li class="admin-container-contact-bio">
                                        <a href="" class="admin-container-contact-link">
                                            <i class="admin-container-contact-icon fa-solid fa-envelope"></i>
                                            Thông báo & bảo mật
                                        </a>
                                    </li>
                                </ul>
                            </div>

                            <div class="admin-container-contact">
                                <ul class="admin-container-contact-list">
                                    <h3 class="admin-container-contact-heading">Quản lí tài khoản</h3>
                                    <li class="admin-container-contact-bio">
                                        <a href="" class="admin-container-contact-link">
                                            <i class="admin-container-contact-icon fa-solid fa-hand"></i>
                                            Đặt hàng
                                        </a>
                                    </li>
                                    
                                    <li class="admin-container-contact-bio">
                                        <a href="" class="admin-container-contact-link">
                                            <i class="admin-container-contact-icon fa-solid fa-heart"></i>
                                            Yêu thích
                                        </a>
                                    </li>
                                    
                                    <li class="admin-container-contact-bio">
                                        <a href="" class="admin-container-contact-link">
                                            <i class="admin-container-contact-icon fa-solid fa-gift"></i>
                                            Quà tặng
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="grid__column-9">
                        <div class="form">
                            <form action="/submit" method="post" class="form-main" enctype="multipart/form-data">
                                <!-- form img -->
                                <div class="form-main__wrap">
                                    <div class="form-img">
                                        <label for="form-img__input" class="form-img__label">Ảnh sản phẩm:</label>
                                        <input type="text" class="form-img__input" name="img">
                                    </div>
                                    <div class="form-img">
                                        <label for="form-img__input" class="form-img__label">Danh mục:</label>
                                        <select class="form-category__select" value="{{listCarts.sale}}" name="sale">
                                        <option value="Error">--- Thuộc danh mục ---</option>
                                        <option value="Thiết bị điện tử">Thiết bị điện tử</option>
                                        <option value="Thời trang nam">Thời trang nam</option>
                                        <option value="Thời trang nữ">Thời trang nữ</option>
                                        <option value="Đồ chơi - Giải trí">Đồ chơi - Giải trí</option>
                                        <option value="Đồ gia dụng">Đồ gia dụng</option>
                                        <option value="Mũ">Mũ</option>
                                        <option value="Túi xách">Túi xách</option>
                                        <option value="Máy ảnh - Máy quay phim">Máy ảnh - Máy quay phim</option>
                                        <option value="Dụng cụ Gym">Dụng cụ Gym</option>
                                        <option value="Thể thao">Thể thao</option>
                                        <option value="Học tập">Học tập</option>
                                        <option value="Thức ăn thú cưng">Thức ăn thú cưng</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-main__wrap">
                                    <div class="form-img">
                                        <label for="form-img__input" class="form-img__label">Ảnh chi tiết 1:</label>
                                        <input type="text" class="form-imgf__input" placeholder="(nếu có)" name="imgf">
                                    </div>
                                    <div class="form-img">
                                        <label for="form-img__input" class="form-img__label">Ảnh chi tiết 2:</label>
                                        <input type="text" class="form-imgs__input" placeholder="(nếu có)" name="imgs">
                                    </div>
                                </div>

                                <div class="form-main__wrap">
                                    <div class="form-img">
                                        <label for="form-img__input" class="form-img__label">Ảnh chi tiết 3:</label>
                                        <input type="text" class="form-imgt__input" placeholder="(nếu có)" name="imgt">
                                    </div>
                                    
                                    <div class="form-img">
                                        <label for="form-img__input" class="form-img__label">Ảnh chi tiết 4:</label>
                                        <input type="text" class="form-imgp__input" placeholder="(nếu có)" name="imgp">
                                    </div>
                                </div>

                                <div class="form-main__wrap">
                                    <!-- form tên -->
                                    <div class="form-name">
                                        <label for="" class="form-name__label">Tên sản phẩm:</label>
                                        <textarea class="form-name__input" name="name" ></textarea>
                                    </div>

                                    <!-- form giảm giá -->
                                    <div class="form-price">
                                        <label for="" class="form-price__label">Giá sản phẩm:</label>
                                        <input type="text" class="form-price__input" placeholder="Nhập số" name="origin" >
                                    </div>
                                </div>

                                <div class="form-main__wrap">
                                    <!-- form giảm giá -->
                                    <div class="form-discount">
                                        <label for="" class="form-discount-label">Giảm giá (%):</label>
                                        <select class="form-discount__select" name="sale">
                                        <option value="Error">--- Chọn mã giảm giá ---</option>
                                        <option value="10">10%</option>
                                        <option value="20">20%</option>
                                        <option value="30">30%</option>
                                        <option value="40">40%</option>
                                        <option value="50">50%</option>
                                        <option value="60">60%</option>
                                        <option value="70">70%</option>
                                        <option value="80">80%</option>
                                        <option value="90">90%</option>
                                        </select>
                                    </div>

                                    <!-- form xuất xứ -->
                                    <div class="form-country">
                                        <label for="" class="form-country__label">Xuất xứ từ:</label>
                                        <select class="form-country__select" name="country">
                                            <option value="Error">--- Vận chuyển từ ---</option>
                                            <option value="TP. Hồ Chí Minh">Thành Phố Hồ Chí Minh</option>
                                            <option value="Hà Nội">Hà Nội</option>
                                            <option value="Đà Nẳng">Đà Nẳng</option>
                                            <option value="Cần Thơ">Cần Thơ</option>
                                            <option value="Nước Ngoài">Nước Ngoài</option>
                                        <!-- Thêm các quốc gia khác tương tự -->
                                        </select>
                                    </div>
                                </div>

                                <!-- nút submit -->
                                <div class="form-submit">
                                    <button class="submit">Lưu lại</button>
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</body>
</html>

<script src="../assets/js/app.js"></script>
<script>
    function getParameterByName(name) {
    var url = new URL(window.location.href);
    return url.searchParams.get(name);
}

// Lấy id sản phẩm từ URL
var productId = getParameterByName('id');

// Tải dữ liệu sản phẩm dựa trên id
fetch(`http://localhost:3000/products/${productId}`)
    .then(function(response) {
        return response.json();
    })
    .then(function(product) {
        // Điền các trường của biểu mẫu với dữ liệu sản phẩm được tải
        document.querySelector(".form-name__input").value = product.name;
        document.querySelector(".form-price__input").value = product.origin;
        document.querySelector(".form-img__input").value = product.img;
        document.querySelector(".form-imgf__input").value = product.imgf
        document.querySelector(".form-imgs__input").value = product.imgs
        document.querySelector(".form-imgt__input").value = product.imgt
        document.querySelector(".form-imgp__input").value = product.imgp
        document.querySelector(".form-discount__select").value = product.sale;
        document.querySelector(".form-country__select").value = product.country;
        document.querySelector(".form-category__select").value = product.category;
    });

// Xử lý khi gửi biểu mẫu (tương tự như handlesCreateProducts)
document.querySelector('.submit').onclick = function () {
    // Thu thập dữ liệu cập nhật từ các trường của biểu mẫu
    var updatedName = document.querySelector(".form-name__input").value;
    var updatedPrice = document.querySelector(".form-price__input").value;
    var updatedImg = document.querySelector(".form-img__input").value;
    var updatedImgf = document.querySelector(".form-imgf__input").value
    var updatedImgs = document.querySelector(".form-imgs__input").value
    var updatedImgt = document.querySelector(".form-imgt__input").value
    var updatedImgp = document.querySelector(".form-imgp__input").value
    var updatedDiscount = document.querySelector(".form-discount__select").value;
    var updatedCountry = document.querySelector(".form-country__select").value;
    var updatedCategory = document.querySelector(".form-category__select").value;

    // Tạo đối tượng với dữ liệu cập nhật
    var updatedProduct = {
        name: updatedName,
        origin: updatedPrice,
        img: updatedImg,
        imgf: updatedImgf,
        imgs: updatedImgs,
        imgt: updatedImgt,
        imgp: updatedImgp,
        sale: updatedDiscount,
        country: updatedCountry,
        category: updatedCategory
    };

    // Thực hiện cập nhật bằng cách gửi yêu cầu PUT đến JSON Server
    var options = {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify(updatedProduct)
    };

    fetch(`http://localhost:3000/products/${productId}`, options)
        .then(function(response) {
            return response.json();
        })
        .then(function() {
            // Chuyển hướng đến trang chính hoặc thực hiện hành động mong muốn khác
            window.location.href = "admin.html";
        });
};
</script>